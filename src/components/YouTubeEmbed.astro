---
import { createYouTubeEmbedUrl, validateVideoId, type YouTubeEmbedOptions } from "../utils/youtube";

interface Props extends YouTubeEmbedOptions {
	width?: string;
	height?: string;
}

const {
	videoId,
	title = "YouTube video",
	width = "100%",
	height = "315",
	autoplay = false,
	mute = false,
	rel = false,
	start,
	end,
} = Astro.props;

// バリデーション
if (!validateVideoId(videoId)) {
	throw new Error(`Invalid YouTube videoId: ${videoId}`);
}

// YouTubeの埋め込みURLを生成
const embedOptions: YouTubeEmbedOptions = {
	videoId,
	autoplay,
	mute,
	rel,
};

if (start !== undefined) embedOptions.start = start;
if (end !== undefined) embedOptions.end = end;

const embedUrl = createYouTubeEmbedUrl(embedOptions);
---

<div class="youtube-embed my-4 sm:my-6">
	<div class="relative w-full" style="padding-bottom: 56.25%;">
		<iframe
			src={embedUrl}
			title={title}
			width={width}
			height={height}
			class="absolute top-0 left-0 h-full w-full rounded-lg border-0"
			allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
			allowfullscreen
			loading="lazy"
			sandbox="allow-same-origin allow-scripts allow-presentation allow-popups allow-popups-to-escape-sandbox"
		></iframe>
	</div>
</div>

<style>
	.youtube-embed {
		--youtube-border-radius: 0.5rem;
		--youtube-hover-scale: 1.02;
		--youtube-transition-duration: 0.2s;
		--youtube-dark-brightness: 0.9;

		max-width: 100%;
		overflow: hidden;
	}

	.youtube-embed iframe {
		border-radius: var(--youtube-border-radius);
		transition: transform var(--youtube-transition-duration) ease-in-out;
	}

	/* ダークモード対応 */
	@media (prefers-color-scheme: dark) {
		.youtube-embed iframe {
			filter: brightness(var(--youtube-dark-brightness));
		}
	}

	/* ホバー効果 */
	.youtube-embed:hover iframe {
		transform: scale(var(--youtube-hover-scale));
	}
</style>
